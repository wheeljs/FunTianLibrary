<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: cache.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: cache.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>define(['jquery'], function ($) {
    'use strict';

    /**
     * 基于localStorage的缓存封装，允许缓存字符串之外的值，通过调用JSON.stringify()将对象序列化为JSON后存放在localStorage中。
     *
     * @class
     * @constructor
     * @param {object} options 配置对象，如果不指定该参数，则使用Cache.defaults默认配置对象。
     * @param {number} options.invalidSeconds 缓存过期时间（秒）。
     * @exports cache
     */
    function Cache(options) {
        var opts = $.extend({}, Cache.defaults, options);

        this.options = opts;
    }

    /**
     * 通过key获取已缓存的值，缓存过期返回null并会被移除，否则返回缓存的值。
     *
     * @public
     * @param {string} key 缓存的键。
     * @return {Object|null} 被缓存的值，如果缓存过期则返回null。
     */
    Cache.prototype.get = function (key) {
        if (key in window.localStorage == true) {
            var value = window.localStorage.getItem(key);
            if (value != undefined) {
                value = JSON.parse(value);
                if (value.invalidtime != 0
                    &amp;&amp; value.invalidtime &lt; new Date().getTime()
                ) {
                    this.remove(key);
                    return null;
                }

                return value.obj;
            }
        }

        return null;
    };

    /**
     * 设置缓存，key指定了缓存的键，value指定了缓存的值，options指定了本次的配置。
     *
     * @public
     * @param {string} key 缓存的键。
     * @param {*} value 缓存的值。
     * @param {Object=} options 本次设置使用的配置，优先级高于实例的配置。
     * @param {number} options.invalidSeconds 缓存过期时间（秒），0为永不过期，设为永不过期的缓存项只能通过调用remove或removeAll清除。
     * @return {boolean} 是否成功加入缓存，成功返回true，否则返回false。
     */
    Cache.prototype.set = function (key, value, options) {
        if (key == undefined) {
            return false;
        }

        if (options == undefined) {
            options = {};
        }

        var opts = $.extend({}, this.options, options);

        var val = {
            'invalidtime': new Date().getTime(),
            'obj': value
        };
        if (isNaN(opts.invalidSeconds) == false) {
            if (opts.invalidSeconds == 0) {
                val.invalidtime = 0;
            }
            else {
                val.invalidtime += (opts.invalidSeconds * 1000);
            }
        }
        else {
            val.invalidtime += (opts.invalidSeconds * 1000);
        }

        window.localStorage.setItem(key, JSON.stringify(val));
        return true;
    };

    /**
     * 从缓存中删除指定项。
     *
     * @public
     * @param {string} key 缓存的键。
     * @return {boolean} 返回(key in window.localStorage)的值。
     */
    Cache.prototype.remove = function (key) {
        if (key in window.localStorage == true) {
            window.localStorage.removeItem(key);
            return key in window.localStorage == false;
        }

        return true;
    };

    /**
     * 从缓存中移除所有与参数匹配的项。
     *
     * @public
     * @param {RegExp=} reg 一个指定要删除项的正则表达式，如果为null，默认为/.+/。
     * @return {number} 移除项的数量。
     */
    Cache.prototype.removeAll = function (reg) {
        var removeCount = 0;

        if (typeof reg === 'undefined') {
            reg = /.+/;
        }

        var ls = window.localStorage;
        for (var key in ls) {
            if (ls.hasOwnProperty(key)) {
                if (reg.test(key) == true) {
                    ls.removeItem(key);
                    removeCount += 1;
                }
            }
        }

        return removeCount;
    };

    /**
     * 缓存的默认配置，当实例化Cache类不指定config参数时将使用默认配置。
     *
     * 可配置项：
     * &lt;ul>
     *        &lt;li>invalidSeconds：缓存过期时间（秒），默认为1800秒。&lt;/li>
     * &lt;/ul>
     */
    Cache.defaults = {
        'invalidSeconds': 30 * 60
    };

    return Cache;
});
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-cache.html">cache</a></li><li><a href="module-common.html">common</a></li><li><a href="module-loader-button.html">loader-button</a></li><li><a href="module-template-helper.html">template-helper</a></li><li><a href="module-templates.html">templates</a></li><li><a href="module-ui-base.html">ui-base</a></li></ul><h3>Namespaces</h3><ul><li><a href="module-common-String.html">String</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.3.0-beta2</a> on Wed Mar 18 2015 09:43:08 GMT+0800 (中国标准时间)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
